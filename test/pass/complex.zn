# Test: Complex program combining multiple features

# Helper function
func my_abs(x: float) {
    if x < 0.0 {
        return -x
    }
    x
}

# Newton's method for square root
func sqrt(n: float) {
    let MAX_ITERATIONS = 1000
    let EPSILON = 0.0001
    var guess = n / 2.0
    var iterations = 0

    while my_abs(guess * guess - n) >= EPSILON {
        if iterations >= MAX_ITERATIONS {
            break 0.0
        }
        guess = (guess + n / guess) / 2.0
        iterations++
    }

    guess
}

# Fibonacci with loop
func fib(n: int) {
    if n <= 1 {
        return n
    }

    var a = 0
    var b = 1

    for var i = 2; i <= n; i++ {
        var temp = a + b
        a = b
        b = temp
    }

    b
}

# Main function
func main() {
    var result = sqrt(2.0)
    var fib10 = fib(10)

    # Verify sqrt(2) is approximately 1.4142
    if result < 1.41 { return 1 }
    if result > 1.42 { return 1 }

    # Verify fib(10) = 55
    if fib10 != 55 { return 1 }

    # Process a range
    var even_count = 0
    for var i = 0; i < 10; i++ {
        var f = fib(i)
        if f % 2 == 0 {
            even_count++
        }
    }

    0
}
